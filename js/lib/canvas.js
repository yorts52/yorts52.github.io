!function(){var t=!1,i=/horizon/.test(function(){horizon})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(e){function n(){!t&&this.init&&this.init.apply(this,arguments)}var h=this.prototype;t=!0;var s=new this;t=!1;for(var r in e)s[r]="function"==typeof e[r]&&"function"==typeof h[r]&&i.test(e[r])?function(t,i){return function(){var e=this._super;this._super=h[t];var n=i.apply(this,arguments);return this._super=e,n}}(r,e[r]):e[r];return n.prototype=s,n.constructor=n,n.extend=arguments.callee,n};var e=Class.extend({init:function(t){void 0===t&&(t={}),this.x="number"==typeof t.x?t.x:0,this.y="number"==typeof t.y?t.y:0,this.width="number"==typeof t.width?t.width:0,this.height="number"==typeof t.height?t.height:0,this.stage=null,this.draw="function"==typeof t.draw?t.draw:function(){}}}),n=e.extend({init:function(t){this._super(t),this.eventListener={}},addEventListener:function(t,i){null!==this.eventListener[t]&&void 0!==this.eventListener[t]||(this.eventListener[t]=[]),this.eventListener[t].push(i)},removeEventListener:function(t,i){if(null!==this.eventListener[t]&&void 0!==this.eventListener[t]){for(var e=0;e<this.eventListener[t].length;e++)this.eventListener[t][e]==i&&(delete this.eventListener[t][e],this.eventListener[t].splice(e,1));0===this.eventListener[t].length&&delete this.eventListener[t]}},removeAllEventListener:function(t){null!==this.eventListener[t]&&void 0!==this.eventListener[t]&&(this.eventListener[t].splice(),delete this.eventListener[t])},hasEventListener:function(t){return!!this.eventListener[t]&&this.eventListener[t].length>0}}),h=n.extend({init:function(t,i){this._super(i),this.ctx=t,this.children=[],this.maxWidth=0,this.maxHeight=0,this.hoverChildren=[]},addEventListener:function(t,i){this._super(t,i)},removeEventListener:function(t,i){this._super(t,i)},removeAllEventListener:function(t){this._super(t)},hasEventListener:function(t){this._super(t)},getContext:function(){return this.ctx},addChild:function(t){this.maxWidth<t.x+t.width&&(this.maxWidth=t.x+t.width),this.maxHeight<t.y+t.height&&(this.maxHegiht=t.y+t.height),t.stage=this,this.children.push(t)},addChildAt:function(t,i){this.maxWidth<t.x+t.width&&(this.maxWidth=t.x+t.width),this.maxHeight<t.y+t.height&&(this.maxHeight=t.y+t.height),t.stage=this,this.children.splice(i,0,t)},removeChild:function(t){if(this.children.splice(this.getChildIndex(t),1),this.maxWidth==t.x+t.width){this.maxWidth=0;for(var i=0;i<this.children.length;i++)this.maxWidth<this.children[i].x+this.children[i].width&&(this.maxWidth=this.children[i].x+this.children[i].width)}if(this.maxHeight==t.y+t.height){this.maxHeight=0;for(var i=0;i<this.children.length;i++)this.maxHeight<this.children[i].y+this.children[i].height&&(this.maxHeight=this.children[i].y+this.children[i].height)}t.stage=null},removeChildAt:function(t){this.children[t].stage=null;var i=this.children.splice(t,1);if(this.maxWidth==i.x+i.width){this.maxWidth=0;for(var e=0;e<this.children.length;e++)this.maxWidth<this.children[e].x+this.children[e].width&&(this.maxWidth=this.children[e].x+this.children[e].width)}if(this.maxHeight==i.y+i.height){this.maxHeight=0;for(var e=0;e<this.children.length;e++)this.maxHeight=0,this.maxHeight<this.children[e].y+this.children[e].height&&(this.maxHeight=this.children[e].y+this.children[e].height)}},getChildAt:function(t){return this.children[t]},getChildIndex:function(t){for(var i=0;i<this.children.length;i++)if(this.children[i]==t)return i;return-1},contains:function(t){return this.getChildIndex(t)!=-1},dispatchMouseEvent:function(t,i,e){for(var n=i,h=e,s=[],r=0;r<this.children.length;r++)if(this.children[r].dispatchMouseEvent&&this.children[r].dispatchMouseEvent(t,n-this.children[r].x,h-this.children[r].y),n>this.children[r].x&&n<this.children[r].x+this.children[r].width&&h>this.children[r].y&&h<this.children[r].y+this.children[r].height){if("mousemove"==t&&s.push(this.children[r]),null==this.children[r].eventListener[t]||void 0==this.children[r].eventListener[t])continue;for(var o=0,a=this.children[r].eventListener[t];o<a.length;o++)a[o](n-this.children[r].x,h-this.children[r].y)}if("mousemove"==t){for(var u=0;u<this.hoverChildren.length;u++){for(var c=!1,l=0;l<s.length;l++)this.hoverChildren[u]==s[l]&&(c=!0);if(!c){if(this.hoverChildren[u].eventListener.mouseout)for(var r=0,d=this.hoverChildren[u];r<d.eventListener.mouseout.length;r++)d.eventListener.mouseout[r](n-d.x,h-d.y);delete this.hoverChildren[u]}}for(var u=0;u<s.length;u++){for(var c=!1,l=0;l<this.hoverChildren.length;l++)s[u]==this.hoverChildren[l]&&(c=!0);if(!c&&(this.hoverChildren.push(s[u]),s[u].eventListener.mouseover))for(var r=0,v=s[u];r<v.eventListener.mouseover.length;r++)v.eventListener.mouseover[r](n-v.x,h-v.y)}this.clearHoverChildren()}},clearHoverChildren:function(){for(var t=[],i=0;i<this.hoverChildren.length;i++)null!=this.hoverChildren[i]&&void 0!=this.hoverChildren[i]&&t.push(this.hoverChildren[i]);this.hoverChildren=t}}),s=h.extend({init:function(t,i){if(this._super(t.getContext("2d"),i),void 0===t)throw new Error("htmlCanvasElement undefined");this.canvas=t,this.isStart=!1,this.interval=16,this.timer=null,this.stage=null,this.CONFIG={interval:16,isClear:!0},this.width=t.width,this.height=t.height;var e=this,n=function(t,i){for(var n=0;n<i.length;n++)t.addEventListener(i[n],function(t,e){return function(n){var h=n.clientX-t.canvas.offsetLeft,s=n.clientY-t.canvas.offsetTop;if(t.eventListener[i[e]])for(var r=0;r<t.eventListener[i[e]].length;r++)t.eventListener[i[e]][r](h,s);t.dispatchMouseEvent(i[e],h,s)}}(e,n),!1)},h=function(t,i){for(var n=0;n<i.length;n++)t.addEventListener(i[n],function(t,e){return function(n){if(t.eventListener[i[e]])for(var h=0;h<t.eventListener[i[e]].length;h++)t.eventListener[i[e]][h](n)}}(e,n),!1)};n(this.canvas,["mousemove","mouseup","mousedown","click","mouseover","mouseout","mouseenter","mouseleave"]),h(this.canvas,["keyup","keydown","keypress"])},onRefresh:function(){},addEventListener:function(t,i){return this._super(t,i)},removeEventListener:function(t,i){return this._super(t,i)},removeAllEventListener:function(t){return this._super(t)},hasEventListener:function(t){return this._super(t)},getContext:function(){return this._super()},addChild:function(t){return this._super(t)},addChildAt:function(t,i){return this._super(t,i)},removeChild:function(t){return this._super(t)},removeChildAt:function(t,i){return this._super(t,i)},getChildAt:function(t){return this._super(t)},getChildIndex:function(t){return this._super(t)},contains:function(t){return this._super(t)},dispatchMouseEvent:function(t,i,e){return this._super(t,i,e)},clearHoverChildren:function(){return this._super()},render:function(){!!this.CONFIG.isClear&&this.clear(),this.draw();for(var t=0;t<this.children.length;t++)this.ctx.translate(this.children[t].x,this.children[t].y),this.children[t].render(),this.ctx.translate(-this.children[t].x,-this.children[t].y)},clear:function(t,i,e,n){void 0!==t&&void 0!==i&&void 0!==e&&void 0!==n?this.ctx.clearRect(t,i,e,n):this.ctx.clearRect(0,0,this.width,this.height)},start:function(){this.isStart=!0,this.timer=setInterval(function(t){return function(){t.render(),t.onRefresh()}}(this),this.CONFIG.interval)},stop:function(){this.isStart=!1,clearInterval(this.timer)}}),r=h.extend({init:function(t,i){this._super(t,i),this.isDragging=!1,this.dragPos={},this.dragFunc=null,this.dropFunc=null},addEventListener:function(t,i){return this._super(t,i)},removeEventListener:function(t,i){return this._super(t,i)},removeAllEventListener:function(t){return this._super(t)},hasEventListener:function(t){return this._super(t)},getContext:function(){return this._super()},addChild:function(t){return this._super(t)},addChildAt:function(t,i){return this._super(t,i)},removeChild:function(t){return this._super(t)},removeChildAt:function(t){return this._super(t)},getChildAt:function(t){return this._super(t)},getChildIndex:function(t){return this._super(t)},contains:function(t){return this._super(t)},dispatchMouseEvent:function(t,i,e){return this._super(t,i,e)},clearHoverChildren:function(){return this._super()},render:function(){this.draw(),this.ctx.scale(this.width<this.maxWidth?this.width/this.maxWidth:1,this.height<this.maxHeight?this.height/this.maxHeight:1);for(var t=0;t<this.children.length;t++)this.ctx.translate(this.children[t].x,this.children[t].y),this.children[t].render(),this.children[t].translate(-this.children[t].x,this.children[t].y);this.ctx.scale(this.width<this.maxWidth?this.maxWidth/this.width:1,this.height<this.maxHeight?this.maxHeight/this.height:1)},onDrag:function(t,i){var e=this;this.isDragging=!0,this.dragPos.x=t+this.x,this.dragPos.y=i+this.y,this.dragFunc=function(t,i){var n=t-e.dragPos.x,h=i-e.dragPos.y;e.x+=n,e.y+=h,e.dragPos.x=t,e.dragPos.y=i},this.dropFunc=function(t,i){e.onDrop()},this.stage.addEventListener("mousemove",this.dragFunc),this.stage.addEventListener("mouseout",this.dropFunc)},onDrop:function(){this.isDragging=!1,this.dragPos={},this.stage.removeEventListener("mousemove",this.dragFunc),this.stage.removeEventListener("mouseout",this.dropFunc),delete this.dragFunc,delete this.dropFunc}}),o=Class.extend({init:function(t,i){this.x=t,this.y=i},copy:function(){return new o(this.x,this.y)},length:function(){return Math.sqrt(this.sqrLength())},sqrLength:function(){return this.x*this.x+this.y*this.y},normalize:function(){var t=1/this.length();return new o(this.x*t,this.y*t)},negate:function(){return new o((-this.x),(-this.y))},add:function(t){return new o(this.x+t.x,this.y+t.y)},subtract:function(t){return new o(this.x-t.x,this.y-t.y)},multiply:function(t){return new o(this.x*t,this.y*t)},divide:function(t){return new o(this.x/t,this.y/t)},dot:function(t){return new o(this.x*t.x,this.y*t.y)}});o.zero=new o(0,0);var a=Class.extend({init:function(t,i,e){this.r=t,this.g=i,this.b=e},copy:function(){return new a(this.r,this.g,this.b)},add:function(t){return new a(Math.min(this.r+t.r,1),Math.min(this.g+t.g,1),Math.min(this.b+t.b,1))},subtract:function(t){return new a(Math.max(this.r-t.r,0),Math.max(this.g-t.g,0),Math.max(this.b-t.b,0))},multiply:function(t){return new a(Math.min(this.r*t,1),Math.min(this.g*t,1),Math.min(this.b*t,1))},divide:function(t){return new a(this.r/t,this.g/t,this.b/t)},modulate:function(t){return new a(this.r*t.r,this.g*t.g,this.b*t.b)},saturate:function(){this.r=Math.min(this.r,1),this.g=Math.min(this.g,1),this.b=Math.min(this.b,1)}});a.black=new a(0,0,0),a.white=new a(1,1,1),a.red=new a(1,0,0),a.green=new a(0,1,0),a.blue=new a(0,0,1),a.yellow=new a(1,1,0),a.cyan=new a(0,1,1),a.purple=new a(1,0,1);var u=Class.extend({init:function(t){this.position=t.position,this.velocity=t.velocity,this.acceleration=o.zero,this.age=0,this.life=t.life,this.color=t.color,this.size=t.size}}),c=Class.extend({init:function(){this.$private={particles:[]},this.gravity=new o(0,100),this.effectors=[]},emit:function(t){this.$private.particles.push(t)},simulate:function(t){this.aging(t),this.applyGravity(),this.applyEffectors(),this.kinematics(t)},aging:function(t){for(var i=0;i<this.$private.particles.length;){var e=this.$private.particles[i];e.age+=t,e.age>e.life?this.kill(i):i++}},kill:function(t){t<this.$private.particles.length&&this.$private.particles.splice(t,1)},applyGravity:function(){for(var t in this.$private.particles)this.$private.particles[t].acceleration=this.gravity},applyEffectors:function(){for(var t in this.effectors){var i=this.effectors[t].apply;for(var e in this.$private.particles)i(this.$private.particles[e])}},kinematics:function(t){for(var i in this.$private.particles){var e=this.$private.particles[i];e.position=e.position.add(e.velocity.multiply(t)),e.velocity=e.velocity.add(e.acceleration.multiply(t))}},render:function(t){for(var i in this.$private.particles){var e=this.$private.particles[i],n=1-e.age/e.life;t.fillStyle="rgba("+Math.floor(255*e.color.r)+", "+Math.floor(255*e.color.g)+", "+Math.floor(e.color.b)+", "+n.toFixed(2)+")",t.beginPath(),t.arc(e.position.x,e.position.y,e.size,0,2*Math.PI,!0),t.closePath(),t.fill()}}}),l=Class.extend({init:function(t,i,e,n){this.apply=function(h){(h.position.x-h.size<t||h.position.x+h.size>e)&&(h.velocity.x*=-1),(h.position.y-h.size<i||h.position.y+h.size>n)&&(h.velocity.y*=-1)}}});this.Stage=s,this.Sprite=r,this.Vector2=o,this.Color=a,this.Particle=u,this.ParticleSystem=c,this.ParticleBlock=l}();