// form m.tianmao.com
var css3 = (function() {
	var css3={},docElement=document.documentElement,mod="modernizr",injectElementWithStyles=function(rule,callback,nodes,testnames){var style,ret,node,div=document.createElement("div"),body=document.body,fakeBody=body?body:document.createElement("body");if(parseInt(nodes,10)){while(nodes--){node=document.createElement("div");node.id=testnames?testnames[nodes]:mod+(nodes+1);div.appendChild(node)}}style=["&#173;",'<style id="s',mod,'">',rule,"</style>"].join("");div.id=mod;(body?div:fakeBody).innerHTML+=style;fakeBody.appendChild(div);if(!body){fakeBody.style.background="";docElement.appendChild(fakeBody)}ret=callback(div,rule);!body?fakeBody.parentNode.removeChild(fakeBody):div.parentNode.removeChild(div);return !!ret};var cssomPrefixes="Webkit Moz O ms".split(" "),mStyle=docElement.style;function is(obj,type){return typeof obj===type}function testProps(props,prefixed){for(var i in props){if(mStyle[props[i]]!==undefined){return prefixed=="pfx"?props[i]:true}}return false}function testPropsAll(prop,prefixed,elem){var ucProp=prop.charAt(0).toUpperCase()+prop.substr(1),props=(prop+" "+cssomPrefixes.join(ucProp+" ")+ucProp).split(" ");if(is(prefixed,"string")||is(prefixed,"undefined")){return testProps(props,prefixed)}else{}}css3.hasTransform=function(){return !!testPropsAll("transform")};css3.has3d=function(){var ret=!!testPropsAll("perspective");if(ret&&"webkitPerspective" in docElement.style){injectElementWithStyles("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(node,rule){ret=node.offsetLeft===9&&node.offsetHeight===3})}return ret};return css3;
})();
(function(){
	// var css3=require("fp-m/lib/css3");
	var isAndroid=(/android/gi).test(navigator.appVersion),has3d=css3.has3d(),hasTransform=css3.hasTransform(),gv1=has3d?"translate3d(":"translate(",gv2=has3d?",0)":")";$.touchSlider=function(container,options){if(!container){return null}if(options){options.container=container}else{options=typeof container=="string"?{container:container}:container}$.extend(this,{container:".slider",wrap:null,panel:null,trigger:null,activeTriggerCls:"sel",hasTrigger:false,steps:0,left:0,visible:1,margin:0,curIndex:0,duration:300,loop:false,play:false,interval:5000,useTransform:!isAndroid,lazy:".lazyimg",lazyIndex:1,callback:null,prev:null,next:null,activePnCls:"none"},options);this.findEl()&&this.init()&&this.increaseEvent()};$.extend($.touchSlider.prototype,{reset:function(options){$.extend(this,options||{});this.init()},findEl:function(){var container=this.container=$(this.container);if(!container.length){return null}this.wrap=this.wrap&&container.find(this.wrap)||container.children().first();if(!this.wrap.length){return null}this.panel=this.panel&&container.find(this.panel)||this.wrap.children().first();if(!this.panel.length){return null}this.panels=this.panel.children();if(!this.panels.length){this.container.hide();return null}this.trigger=this.trigger&&container.find(this.trigger);this.prev=this.prev&&container.find(this.prev);this.next=this.next&&container.find(this.next);return this},init:function(){var wrap=this.wrap,panel=this.panel,panels=this.panels,trigger=this.trigger,len=this.len=panels.length,margin=this.margin,allWidth=0,status=this.visible,useTransform=this.useTransform=hasTransform?this.useTransform:false;this.steps=this.steps||wrap.width();panels.each(function(n,item){allWidth+=item.offsetWidth});if(margin&&typeof margin=="number"){allWidth+=(len-1)*margin;this.steps+=margin}if(status>1){this.loop=false}var initLeft=this.left;initLeft-=this.curIndex*this.steps;this.setCoord(panel,initLeft);if(useTransform){wrap.css({"-webkit-transform":"translate3d(0,0,0)"});panel.css({"-webkit-backface-visibility":"hidden"});panels.css({"-webkit-transform":gv1+"0,0"+gv2})}var pages=this._pages=Math.ceil(len/status);this._minpage=0;this._maxpage=this._pages-1;this.loadImg();this.updateArrow();if(pages<=1){this.getImg(panels[0]);trigger&&trigger.hide();return null}if(this.loop){panel.append(panels[0].cloneNode(true));var lastp=panels[len-1].cloneNode(true);panel.append(lastp);this.getImg(lastp);lastp.style.cssText+="position:relative;left:"+(-this.steps*(len+2))+"px;";allWidth+=panels[0].offsetWidth;allWidth+=panels[len-1].offsetWidth}panel.css("width",allWidth);if(trigger&&trigger.length){var temp="",childstu=trigger.children();if(!childstu.length){for(var i=0;i<pages;i++){temp+="<span"+(i==this.curIndex?" class="+this.activeTriggerCls+"":"")+"></span>"}trigger.html(temp)}this.triggers=trigger.children();this.triggerSel=this.triggers[this.curIndex]}else{this.hasTrigger=false}return this},increaseEvent:function(){var that=this,_panel=that.wrap[0],prev=that.prev,next=that.next,triggers=that.triggers;if(_panel.addEventListener){_panel.addEventListener("touchstart",that,false);_panel.addEventListener("touchmove",that,false);_panel.addEventListener("touchend",that,false);_panel.addEventListener("webkitTransitionEnd",that,false);_panel.addEventListener("msTransitionEnd",that,false);_panel.addEventListener("oTransitionEnd",that,false);_panel.addEventListener("transitionend",that,false)}if(that.play){that.begin()}if(prev&&prev.length){prev.on("click",function(e){that.backward.call(that,e)})}if(next&&next.length){next.on("click",function(e){that.forward.call(that,e)})}if(that.hasTrigger&&triggers){triggers.each(function(n,item){$(item).on("click",function(){that.slideTo(n)})})}},handleEvent:function(e){switch(e.type){case"touchstart":this.start(e);break;case"touchmove":this.move(e);break;case"touchend":case"touchcancel":this.end(e);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"transitionend":this.transitionEnd(e);break}},loadImg:function(n){n=n||0;if(n<this._minpage){n=this._maxpage}else{if(n>this._maxpage){n=this._minpage}}var status=this.visible,lazyIndex=this.lazyIndex-1,maxIndex=lazyIndex+n;if(maxIndex>this._maxpage){return}maxIndex+=1;var start=(n&&(lazyIndex+n)||n)*status,end=maxIndex*status,panels=this.panels;end=Math.min(panels.length,end);for(var i=start;i<end;i++){this.getImg(panels[i])}},getImg:function(obj){if(!obj){return}obj=$(obj);if(obj.attr("l")){return}var that=this,lazy=that.lazy,cls="img"+lazy;lazy=lazy.replace(/^\.|#/g,"");obj.find(cls).each(function(n,item){var nobj=$(item);src=nobj.attr("dataimg");if(src){nobj.attr("src",src).removeAttr("dataimg").removeClass(lazy)}});obj.attr("l","1")},start:function(e){var et=e.touches[0];this._movestart=undefined;this._disX=0;this._coord={x:et.pageX,y:et.pageY}},move:function(e){if(e.touches.length>1||e.scale&&e.scale!==1){return}var et=e.touches[0],disX=this._disX=et.pageX-this._coord.x,initLeft=this.left,tmleft;if(typeof this._movestart=="undefined"){this._movestart=!!(this._movestart||Math.abs(disX)<Math.abs(et.pageY-this._coord.y))}if(!this._movestart){e.preventDefault();this.stop();if(!this.loop){disX=disX/((!this.curIndex&&disX>0||this.curIndex==this._maxpage&&disX<0)?(Math.abs(disX)/this.steps+1):1)}tmleft=initLeft-this.curIndex*this.steps+disX;this.setCoord(this.panel,tmleft);this._disX=disX}},end:function(e){if(!this._movestart){var distance=this._disX;if(distance<-10){e.preventDefault();this.forward()}else{if(distance>10){e.preventDefault();this.backward()}}distance=null}},backward:function(e){if(e&&e.preventDefault){e.preventDefault()}var cur=this.curIndex,minp=this._minpage;cur-=1;if(cur<minp){if(!this.loop){cur=minp}else{cur=minp-1}}this.slideTo(cur);this.callback&&this.callback(Math.max(cur,minp),-1)},forward:function(e){if(e&&e.preventDefault){e.preventDefault()}var cur=this.curIndex,maxp=this._maxpage;cur+=1;if(cur>maxp){if(!this.loop){cur=maxp}else{cur=maxp+1}}this.slideTo(cur);this.callback&&this.callback(Math.min(cur,maxp),1)},setCoord:function(obj,x){this.useTransform&&obj.css("-webkit-transform",gv1+x+"px,0"+gv2)||obj.css("left",x)},slideTo:function(cur,duration){cur=cur||0;this.curIndex=cur;var panel=this.panel,style=panel[0].style,scrollx=this.left-cur*this.steps;style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=(duration||this.duration)+"ms";this.setCoord(panel,scrollx);this.loadImg(cur)},transitionEnd:function(){var panel=this.panel,style=panel[0].style,loop=this.loop,cur=this.curIndex;if(loop){if(cur>this._maxpage){this.curIndex=0}else{if(cur<this._minpage){this.curIndex=this._maxpage}}this.setCoord(panel,this.left-this.curIndex*this.steps)}if(!loop&&cur==this._maxpage){this.stop();this.play=false}else{this.begin()}this.update();this.updateArrow();style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=0},update:function(){var triggers=this.triggers,cls=this.activeTriggerCls,curIndex=this.curIndex;if(triggers&&triggers[curIndex]){this.triggerSel&&(this.triggerSel.className="");triggers[curIndex].className=cls;this.triggerSel=triggers[curIndex]}},updateArrow:function(){var prev=this.prev,next=this.next;if(!prev||!prev.length||!next||!next.length){return}if(this.loop){return}var cur=this.curIndex,cls=this.activePnCls;cur<=0&&prev.addClass(cls)||prev.removeClass(cls);cur>=this._maxpage&&next.addClass(cls)||next.removeClass(cls)},begin:function(){var that=this;if(that.play&&!that._playTimer){that.stop();that._playTimer=setInterval(function(){that.forward()},that.interval)}},stop:function(){var that=this;if(that.play&&that._playTimer){clearInterval(that._playTimer);that._playTimer=null}},destroy:function(){var that=this,_panel=that.wrap[0],prev=that.prev,next=that.next,triggers=that.triggers;if(_panel.removeEventListener){_panel.removeEventListener("touchstart",that,false);_panel.removeEventListener("touchmove",that,false);_panel.removeEventListener("touchend",that,false);_panel.removeEventListener("webkitTransitionEnd",that,false);_panel.removeEventListener("msTransitionEnd",that,false);_panel.removeEventListener("oTransitionEnd",that,false);_panel.removeEventListener("transitionend",that,false)}if(prev&&prev.length){prev.off("click")}if(next&&next.length){next.off("click")}if(that.hasTrigger&&triggers){triggers.each(function(n,item){$(item).off("click")})}}});$.touchSlider.cache=[];$.fn.slider=function(options){return this.each(function(n,item){if(!item.getAttribute("l")){item.setAttribute("l",true);$.touchSlider.cache.push(new $.touchSlider(item,options))}})};$.touchSlider.destroy=function(){var cache=$.touchSlider.cache,len=cache.length;if(len<1){return}for(var i=0;i<len;i++){cache[i].destroy()}$.touchSlider.cache=[]};return $.touchSlider;
})();